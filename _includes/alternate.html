{%- comment -%}
alternate タグ出力テンプレート（taxonomy/post/トップページ自動対応）

- taxonomy: /device/lang/type/slug/
- post:     /device/lang/slug/
- top:      /device/lang/ or /device/lang/index.html
{%- endcomment -%}

{%- assign alt_cfg = site.alternate | default: {} -%}
{%- assign enabled = alt_cfg.enabled | default: true -%}
{%- assign supported_langs = alt_cfg.supported_langs | default: "ja,en" | split: "," -%}
{%- assign base_device = alt_cfg.base_device | default: "pc" -%}
{%- assign url = page.url | default: "/" -%}
{%- assign url_parts = url | split: "/" -%}

{%- assign device = url_parts[1] | default: "pc" -%}
{%- assign lang = url_parts[2] | default: "ja" -%}
{%- assign type = nil -%}
{%- assign slug = nil -%}

{%- assign path_depth = url_parts | size -%}

{%- if path_depth >= 5 -%}
  {%- assign type = url_parts[3] -%}
  {%- assign slug = url_parts[4] -%}
{%- elsif path_depth == 4 and url_parts[3] != "" -%}
  {%- assign slug = url_parts[3] -%}
{%- elsif path_depth <= 3 or url contains '/index.html' -%}
  {%- assign is_top = true -%}
{%- endif -%}

{%- if enabled -%}
  {%- for alt_lang in supported_langs -%}
    {%- assign base_path = "/" | append: base_device | append: "/" | append: alt_lang -%}
    {%- if is_top -%}
      {%- assign alt_path = base_path | append: "/" -%}
    {%- elsif type and slug -%}
      {%- assign alt_path = base_path | append: "/" | append: type | append: "/" | append: slug | append: "/" -%}
    {%- elsif slug -%}
      {%- assign alt_path = base_path | append: "/" | append: slug | append: "/" -%}
    {%- else -%}
      {%- continue -%}
    {%- endif -%}
    <link rel="alternate" hreflang="{{ alt_lang | strip }}" href="{{ alt_path | absolute_url }}">
  {%- endfor -%}
  <link rel="alternate" hreflang="x-default" href="{{ '/' | absolute_url }}">
{%- endif -%}
