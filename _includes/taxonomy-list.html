{%- assign device = include.device | default: page.device | default: 'text' -%}
{%- assign lang = include.lang | default: page.lang | default: 'ja' -%}
{%- assign type = include.type | default: 'categories' -%}
{%- assign ui = include.taxonomy_ui | default: {} -%}
{%- assign warnings_data = include.taxonomy_warnings_data | default: {} -%}
{%- assign schema = include.taxonomy_schema | default: {} -%}

{%- assign render_format = 'html' -%}
{%- if device == 'text' -%}
  {%- assign render_format = 'text' -%}
{%- endif -%}

{%- assign base_path = "/" | append: device | append: lang | append: "/" | append: type -%}

{% include taxonomy_data_preparer.html
  type=type
  lang=lang
  warnings_data=warnings_data
  schema=schema
%}

{%- if render_format == 'html' -%}
<div class="mb-4">
  <input type="text" id="filter" placeholder="{{ ui.search_placeholder[lang] }}" class="border px-2 py-1 mr-2">
  <select id="sort" class="border px-2 py-1">
    <option value="count">{{ ui.sort_options.count[lang] }}</option>
    <option value="name">{{ ui.sort_options.name[lang] }}</option>
  </select>
</div>
{%- endif -%}

<section>
  {%- if render_format == 'html' -%}
    <h3 class="text-lg font-bold">{{ ui.title[type][lang] }}</h3>
    {%- if ui.description[type][lang] != blank -%}
      <p class="text-sm text-gray-500">{{ ui.description[type][lang] }}</p>
    {%- endif -%}
  {%- endif -%}

  {%- if merged_items.size == 0 -%}
    <p class="text-sm text-red-500 mt-4">{{ ui.empty_message[lang] }}</p>
  {%- endif -%}

  {%- if schema == nil or schema.size == 0 -%}
    <p class="text-red-600 font-bold">{{ ui.error_messages.schema_invalid[lang] }}</p>
  {%- endif -%}

  {% include taxonomy_list_generator.html
    merged_items=merged_items
    base_path=base_path
    ui=ui
    lang=lang
    render_type=render_format
    schema=schema
  %}
</section>
