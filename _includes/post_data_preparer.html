{%- comment -%}
このテンプレートは、postの一覧を受け取り、
post_schemaに基づき default 値を補完した post_attrs を含むオブジェクトに整形して、
merged_posts という配列で出力します。

- 入力: include.posts（site.postsなど）
- 出力: merged_posts（post + post_attrs を持つハッシュ配列）
{%- endcomment -%}

{% include get_context_vars.html
     device=include.device
     lang=include.lang
     ui=include.ui
     warnings_data=include.warnings_data
     labels=include.labels
     schema=include.schema
     type=include.type
     posts=include.posts
     merged_items=include.merged_items
%}

{%- for post in posts -%}
  {%- assign post_attrs = {} -%}
  {%- assign attr_list = "hidden,draft,featured,deprecated,beta,audience,private,admin_only,priority,color,icon,tooltip,created_timestamp,modified_timestamp" | split: "," -%}

  {%- for attr in attr_list -%}
    {%- assign value = post[attr] -%}
    {%- if value == nil -%}
      {%- assign value = schema[attr].default -%}
    {%- endif -%}
    {%- assign post_attrs = post_attrs | merge: {{ attr | jsonify }}: value -%}
  {%- endfor -%}

  {%- assign merged_item = post | merge: { "post_attrs": post_attrs } -%}
  {%- assign merged_items = merged_items | push: merged_item -%}
{%- endfor -%}
